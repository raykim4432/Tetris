/*
 * TCSS 305: Assignment 6
 */

package view;

import java.awt.image.BufferedImage;
import java.io.BufferedReader;
import java.io.File;
import java.io.FileFilter;
import java.io.IOException;
import java.nio.charset.Charset;
import java.nio.file.FileSystems;
import java.nio.file.Files;
import java.nio.file.Path;
import java.util.LinkedList;
import java.util.List;

import javax.imageio.ImageIO;


/**
 * The class holds static methods for reading and writing to files.
 * 
 * @author Ray Kim
 * @version Autumn 2014
 *
 */
public final class FileInteractionHelper {
    
    //constructors and methods
    /**
     * Private constructor for this class.
     */
    private FileInteractionHelper() {
        
    }
    
    //reading text from files
    /**
     * This method reads two ints on a line seperated by an "=" and generates an int array.
     * The int values are derived from a text file (whose directory is passed via the 
     * parameter as as a string location).
     * 
     * The first int value [0] is the lines cleared. The second int value [1] is points for
     * clearing the [0] quantity of lines.
     * 
     * @param theDirectory String location of text file which holds score mappings
     * @return List<int[]> int[0] = lines cleared, int[1] = points
     */
    public static List<int[]> generatePointList(final String theDirectory) {
        final List<int[]> resultList = new LinkedList<>();
        
        final Charset charset = Charset.forName("US-ASCII");
        final Path path = FileSystems.getDefault().getPath(theDirectory);
        
        try (BufferedReader reader = Files.newBufferedReader(path, charset)) {
            
            String line = reader.readLine();
            while (line != null) {
                final int[] scoreMapping = new int[2];
                
                //find index of "="
                final int indexOfEquals = line.indexOf('=');
                
                //get int[0]
                final String key = line.substring(0, indexOfEquals - 1).trim();
                scoreMapping[0] = Integer.parseInt(key);
                
                //get int[1]
                final String value = line.substring(indexOfEquals + 1).trim();
                scoreMapping[1] = Integer.parseInt(value);
                
                //add int[] to resultList
                resultList.add(scoreMapping);
                
                line = reader.readLine();
            }
        } catch (final IOException  exception) {
            exception.printStackTrace();
        }
        
        return resultList;
    }
    
    /**
     * This method generates a JLabel HTML string by reading a List of int[]
     * generated by the generatePointList() method (of this class) and generating a string
     * in the format int[0] lines = int[1] points.
     * 
     * 
     * @param theDirectory String location of text file which holds score mappings
     * @return String HTML string
     */
    public static String txtFileToHTML(final String theDirectory) {
        //get score mapping List from theDirectory
        final List<int[]> scoreMappings = generatePointList(theDirectory);
        
        //build string
        final StringBuilder resultHTML  = new StringBuilder(64);
        resultHTML.append("<html>");

        for (final int[] mapping : scoreMappings) {
            resultHTML.append(mapping[0]);
            resultHTML.append(" lines = ");
            resultHTML.append(mapping[1]);
            resultHTML.append(" points.<br>");
        }
          
        resultHTML.append("</html>");
        
        return resultHTML.toString();
    } //end of txtFileToHTML
    
    
    //getting images from files
    /**
     * This method generates a List of buffered images taken from a directory passed 
     * into this method as a parameter. 
     * 
     * Directory mapping code borrowed from:
     * stackoverflow.com/questions/4917326/how-to-iterate-over-the-files-of-a-certain-
     * directory-in-java
     * 
     * Code for building custom FileFilter borrowed from:
     * stackoverflow.com/questions/13517770/jfilechooser-filters
     * 
     * @param theDirectory containing images
     * @return List<BufferedImage> from the given directory
     */
    public static List<BufferedImage> generateBufferedImageList(final String theDirectory) {
        final List<BufferedImage> imageList = new LinkedList<>();
        
        //retrieve all .jpg, .jpeg, .gif, extensioned files in directory
        final File fileDirectory = new File(theDirectory);
        final File[] directoryImageListing = fileDirectory.listFiles(new FileFilter() {
            /**
             * This method checks a file name for the extensions jpeg, png.
             * @param theFile that is being inspected for the appropriate image type extension.
             * @return boolean true if extension is found
             */
            @Override
            public boolean accept(final File theFile) {
                final String nameOfFile = theFile.getName();
                boolean containsExtension = false;
                
                //check for extension
                if (nameOfFile.endsWith(".jpg") || nameOfFile.endsWith(".jpeg") 
                                                || nameOfFile.endsWith(".png")) {
                    containsExtension = true;
                }
                
                return containsExtension;
            }
        });
        
        //iterate through each image file, pull image into BufferedImage and save to List
        if (directoryImageListing != null) {
            
            for (final File imageFile : directoryImageListing) {
                try {
                    //pull image file to bufferedImage, save BufferedImage to List
                    final BufferedImage bufferedImage = ImageIO.read(imageFile);
                    imageList.add(bufferedImage);
                } catch (final IOException exception) {
                    exception.printStackTrace();
                }
            } //end of for
            
        }
        
        
        return imageList;
        
    } //end of generateBufferedImageList
}
